<html>
  
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../../style.css">
    <base target="_parent">
    <title data-trilium-title>zabbix</title>
  </head>
  
  <body>
    <div class="content">
       <h1 data-trilium-h1>zabbix</h1>

      <div class="ck-content"><pre><code class="language-text-plain">wget https://repo.zabbix.com/zabbix/6.4/debian/pool/main/z/zabbix-release/zabbix-release_6.4-1+debian12_all.deb
dpkg -i zabbix-release_6.4-1+debian12_all.deb
apt update</code></pre><pre><code class="language-text-plain">apt install zabbix-server-mysql zabbix-frontend-php zabbix-apache-conf zabbix-sql-scripts zabbix-agent</code></pre>
        <p>&nbsp;</p>
        <h2><strong>Modification du fuseau horaire</strong></h2>
        <p>&nbsp;</p><pre><code class="language-text-plain">#Attention à bien vérifier la version de php car le chamin ci-dessous ne fonctionnera pas si votre version est différente de 8.2
nano /etc/php/8.2/apache2/php.ini

#Vous modifier la ligne ci-dessous
#Dans nano vous pouvez rechercher en utilisant la combinaison des touches "Ctrl + w"
date.timezone = Europe/Paris</code></pre>
        <p>
          <br>Vous trouverez la liste des fuseaux horaires supportés par PHP en suivant
          le lien ci-dessous.</p>
        <p><a href="https://www.php.net/manual/fr/timezones.europe.php"><strong>PHP: Europe – Manual</strong></a>
        </p>
        <h2><strong>Installation et configuration de MariaDB</strong></h2>
        <p>L’installation de <strong>MariaDB</strong> se fait avec la commande ci-dessous.</p>
        <p>&nbsp;</p><pre><code class="language-text-plain">apt-get install mariadb-server -y</code></pre>
        <p>&nbsp;</p>
        <h2><strong>Lancement du script mariadb-secure-installation</strong></h2>
        <p>Avant d’aller plus loin, on utilise <strong>le script de premier lancement de MariaDB</strong> pour
          nettoyer la base et initialiser quelques paramètres comme le mot de passe
          root pour l’instance <strong>MariaDB</strong>.</p>
        <p>Ce script est déployé lors de l’installation de <strong>MariaDB</strong>.
          il se lance à partir de votre terminal en tapant <strong>mariadb-secure-installation</strong>.</p>
        <p>&nbsp;</p><pre><code class="language-text-plain">root@zabbix:/# mariadb-secure-installation

#NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB
#      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!

#In order to log into MariaDB to secure it, we'll need the current
#password for the root user. If you've just installed MariaDB, and
#haven't set the root password yet, you should just press enter here.

#A la première question vous laissez vide car on a pas encore de mot de passe root pour l'instance MariaDB

Enter current password for root (enter for none): On laisse vide !!!

#Authentification Unix, on tape n pour no
Switch to unix_socket authentication [Y/n] n

#On tape y pour change le mot de passe root de l'instance MariaDB.
Change the root password? [Y/n] Y
New password: *************
Re-enter new password: *************
Password updated successfully!
Reloading privilege tables..
 ... Success!

#On supprime les utilisateurs anonymes enn tapant Y 
Remove anonymous users? [Y/n] Y

#On supprime l'accès distant pour le compte root de l'instance MariaDB par Y 
Disallow root login remotely? [Y/n] Y

#On supprime l'accès à la base de données de test par Y
Remove test database and access to it? [Y/n] Y

#On recharge les modification pour qu'elles soient prises en compte par Y
Reload privilege tables now? [Y/n] Y
 ... Success!

Cleaning up...

All done!  If you've completed all of the above steps, your MariaDB
installation should now be secure.

Thanks for using MariaDB!

root@zabbix:/#</code></pre>
        <p>&nbsp;</p>
        <h2><strong>Création de la base de données et des accès.</strong></h2>
        <p>On se connecte à <strong>MariaDB</strong> avec le <strong>compte root </strong>qu’on
          a créé avec le script <strong>mariadb-secure-installation</strong>.</p>
        <p>&nbsp;</p><pre><code class="language-text-plain">mysql -u root -p
password #Ici vous renseignez le mot de passe configuré plus tôt avec le script mariadb-secure-installation</code></pre>
        <p>Un fois connecté, on commence par créer la base de données, on va l’appeler <strong>zabbix</strong> et
          on lui ajoute un encodage <strong>UTF8</strong>.</p>
        <p>&nbsp;</p><pre><code class="language-text-plain">create database zabbix character set utf8mb4 collate utf8mb4_bin;</code></pre>
        <p>Ensuite on va créer un utilisateur local à l’instance <strong>MariaDB</strong>.
          on utilisera ce compte : <strong>zabbix@localhost </strong>et on lui crée<strong> un mot de passe</strong>.</p>
        <p>&nbsp;</p><pre><code class="language-text-plain">create user zabbix@localhost identified by 'password';</code></pre>
        <p>On ajoute à l’utilisateur <strong>zabbix</strong> les droits à la table <strong>zabbix</strong> et
          à l’ensemble des sous tables.</p>
        <p>&nbsp;</p><pre><code class="language-text-plain">grant all privileges on zabbix.* to zabbix@localhost;</code></pre>
        <p>On active la journalisation des logs qui servira à importer le schéma
          de la table zabbix.</p>
        <p>&nbsp;</p><pre><code class="language-text-plain">set global log_bin_trust_function_creators = 1;</code></pre>
        <p>On applique les changements via la commande.</p>
        <p>&nbsp;</p><pre><code class="language-text-plain">flush  privileges;</code></pre>
        <p>On quitte l’instance <strong>MariaDB</strong>.</p>
        <p>&nbsp;</p><pre><code class="language-text-plain">MariaDB [(none)]&gt; quit;
Bye</code></pre>
        <p>On va aller modifier le fichier de configuration afin d’y renseigner la
          variable <strong>DBPassword</strong>.
          <br>Une fois la modification effectuée, vous enregistrez.</p>
        <p>&nbsp;</p><pre><code class="language-text-plain">nano /etc/zabbix/zabbix_server.conf

#Modifier les lignes suivantes:
DBName=zabbix
DBUser=zabbix
DBPassword= #Mot de passe du compte zabbix@localhost</code></pre>
        <p>Sur le serveur Zabbix, on va importer le schéma initial et les données
          dans la base avec le script <strong>server.sql.gz</strong>. Vous serez invité
          à entrer votre mot de passe du compte <strong>zabbix</strong> à qui on a
          donné accès à la base de données <strong>zabbix</strong>.</p>
        <p>&nbsp;</p><pre><code class="language-text-plain">zcat /usr/share/zabbix-sql-scripts/mysql/server.sql.gz | mysql -u zabbix -p zabbix
Enter password: #Mot de passe à renseigner

#On se reconnecte à la base de données et on désactive la journalisation des logs.

mysql -u root -p
password #Ici vous renseignez le mot de passe configuré plus tôt pour le compte root MariaDB.

#On désactive les logs.
set global log_bin_trust_function_creators = 0;

#On quitte.
MariaDB [(none)]&gt; quit;
Bye</code></pre>
        <p>On redémarre les services du <strong>serveur ZABBIX</strong>, de l’<strong>agent ZABBIX</strong> et
          d’<strong>Apache2</strong>.</p>
        <p>&nbsp;</p><pre><code class="language-text-plain">systemctl restart zabbix-server zabbix-agent apache2</code></pre>
        <p>On ajoute les services en redémarrage automatique, utile si le serveur
          doit être redémarré.</p>
        <p>&nbsp;</p><pre><code class="language-text-plain">systemctl enable zabbix-server zabbix-agent apache2

Synchronizing state of zabbix-server.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install enable zabbix-server
Synchronizing state of zabbix-agent.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install enable zabbix-agent
Synchronizing state of apache2.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install enable apache2
Created symlink /etc/systemd/system/multi-user.target.wants/zabbix-server.service → /lib/systemd/system/zabbix-server.service.
</code></pre>
        <p>Maintenant, on vérifie l’état du serveur Zabbix.</p>
        <p>&nbsp;</p><pre><code class="language-text-plain">systemctl status zabbix-server</code></pre>
        <p>
          <img src="https://itech.nezrond.fr/wp-content/uploads/2023/07/image-37-1024x154.png"
          alt="" srcset="https://itech.nezrond.fr/wp-content/uploads/2023/07/image-37-1024x154.png 1024w, https://itech.nezrond.fr/wp-content/uploads/2023/07/image-37-300x45.png 300w, https://itech.nezrond.fr/wp-content/uploads/2023/07/image-37-768x116.png 768w, https://itech.nezrond.fr/wp-content/uploads/2023/07/image-37.png 1155w"
          sizes="100vw" width="1024" height="154">
        </p>
        <h2><strong>Connection au serveur Zabbix et finalisation de la configuration.</strong></h2>
        <p>Pour se connecter au serveur Zabbix, on utiliser notre navigateur via
          l’URL <strong>http://@IP du serveur ZABBIX/zabbix</strong>
        </p>
        <p>La page de démarrage va nous permettre de paramétrer la langue. Aller
          ensuite sur «&nbsp;<strong>Prochaine étape</strong>«&nbsp;.</p>
        <p>
          <img src="https://itech.nezrond.fr/wp-content/uploads/2023/07/Zabbix_LNG-1024x590.png"
          alt="" srcset="https://itech.nezrond.fr/wp-content/uploads/2023/07/Zabbix_LNG-1024x590.png 1024w, https://itech.nezrond.fr/wp-content/uploads/2023/07/Zabbix_LNG-300x173.png 300w, https://itech.nezrond.fr/wp-content/uploads/2023/07/Zabbix_LNG-768x443.png 768w, https://itech.nezrond.fr/wp-content/uploads/2023/07/Zabbix_LNG.png 1272w"
          sizes="100vw" width="1024" height="590">
        </p>
        <p>On va pouvoir vérifier que l’installation est bien conforme aux différents
          pré requis. Si l’ensemble des pré requis est au vert «&nbsp;OK&nbsp;»,
          vous pouvez valider en cliquant sur «&nbsp;<strong>Prochaine étape</strong>«&nbsp;.</p>
        <p>
          <img src="https://itech.nezrond.fr/wp-content/uploads/2023/07/image-29-1024x576.png"
          alt="" srcset="https://itech.nezrond.fr/wp-content/uploads/2023/07/image-29-1024x576.png 1024w, https://itech.nezrond.fr/wp-content/uploads/2023/07/image-29-300x169.png 300w, https://itech.nezrond.fr/wp-content/uploads/2023/07/image-29-768x432.png 768w, https://itech.nezrond.fr/wp-content/uploads/2023/07/image-29.png 1265w"
          sizes="100vw" width="1024" height="576">
        </p>
        <p>A la prochaine étape, il faudra renseigner le mot de passe pour le compte <strong>zabbix@localhost</strong>.</p>
        <p>
          <img src="https://itech.nezrond.fr/wp-content/uploads/2023/07/image-31-1024x590.png"
          alt="" srcset="https://itech.nezrond.fr/wp-content/uploads/2023/07/image-31-1024x590.png 1024w, https://itech.nezrond.fr/wp-content/uploads/2023/07/image-31-300x173.png 300w, https://itech.nezrond.fr/wp-content/uploads/2023/07/image-31-768x442.png 768w, https://itech.nezrond.fr/wp-content/uploads/2023/07/image-31.png 1262w"
          sizes="100vw" width="1024" height="590">
        </p>
        <p>La page suivante vous invite à renseigner <strong>un nom de serveur</strong> et
          de choisir un thème.</p>
        <p>
          <img src="https://itech.nezrond.fr/wp-content/uploads/2023/07/image-32-1024x587.png"
          alt="" srcset="https://itech.nezrond.fr/wp-content/uploads/2023/07/image-32-1024x587.png 1024w, https://itech.nezrond.fr/wp-content/uploads/2023/07/image-32-300x172.png 300w, https://itech.nezrond.fr/wp-content/uploads/2023/07/image-32-768x440.png 768w, https://itech.nezrond.fr/wp-content/uploads/2023/07/image-32.png 1256w"
          sizes="100vw" width="911" height="522">
        </p>
        <p>Une dernière vérification des différents paramètres sera à valider avant
          de cliquer sur <strong>«&nbsp;Prochaine étape&nbsp;»</strong>.</p>
        <p>
          <img src="https://itech.nezrond.fr/wp-content/uploads/2023/07/image-33-1024x584.png"
          alt="" srcset="https://itech.nezrond.fr/wp-content/uploads/2023/07/image-33-1024x584.png 1024w, https://itech.nezrond.fr/wp-content/uploads/2023/07/image-33-300x171.png 300w, https://itech.nezrond.fr/wp-content/uploads/2023/07/image-33-768x438.png 768w, https://itech.nezrond.fr/wp-content/uploads/2023/07/image-33.png 1253w"
          sizes="100vw" width="1024" height="584">
        </p>
        <p>Si les paramètres sont validés, l’installation se terminera par un succès,
          restera plus qu’à cliquer sur <strong>«&nbsp;terminer&nbsp;»</strong>. Cette
          dernière action vous redirigera vers la page de connexion du serveur <strong>zabbix</strong>.</p>
        <p>
          <img src="https://itech.nezrond.fr/wp-content/uploads/2023/07/image-35-1024x576.png"
          alt="" srcset="https://itech.nezrond.fr/wp-content/uploads/2023/07/image-35-1024x576.png 1024w, https://itech.nezrond.fr/wp-content/uploads/2023/07/image-35-300x169.png 300w, https://itech.nezrond.fr/wp-content/uploads/2023/07/image-35-768x432.png 768w, https://itech.nezrond.fr/wp-content/uploads/2023/07/image-35.png 1240w"
          sizes="100vw" width="1024" height="576">
        </p>
        <p>Une fois sur la page de connexion, le login par défaut est <strong>Admin</strong> et
          le mot de passe est <strong>zabbix</strong>. attention à la casse.</p>
        <p>
          <img src="https://itech.nezrond.fr/wp-content/uploads/2023/07/image-36.png"
          alt="" srcset="https://itech.nezrond.fr/wp-content/uploads/2023/07/image-36.png 541w, https://itech.nezrond.fr/wp-content/uploads/2023/07/image-36-291x300.png 291w"
          sizes="100vw" width="541" height="558">
        </p>
        <p>Une fois connecté, <strong>je vous invite à modifier le mot Admin par défaut par un mot de passe sécurisé</strong>.
          Pour effectuer cette action, il faut ce rendre dans <strong>Utilisateurs</strong> au
          niveau du bandeau à gauche, vous sélectionnez à nouveau <strong>Utilisateurs</strong> et
          vous cliquez sur le compte<strong> Admin</strong>. Cliquez sur <strong>modifier le mot de passe</strong>.</p>
        <p>
          <img src="https://itech.nezrond.fr/wp-content/uploads/2023/07/image-40.png"
          alt="" srcset="https://itech.nezrond.fr/wp-content/uploads/2023/07/image-40.png 1024w, https://itech.nezrond.fr/wp-content/uploads/2023/07/image-40-300x91.png 300w, https://itech.nezrond.fr/wp-content/uploads/2023/07/image-40-768x234.png 768w"
          sizes="100vw" width="1024" height="312">
        </p>
        <p>Une fois le mot de passe modifié, il suffira de cliquer sur actualiser
          et vous serez invité à vous reconnecter.</p>
        <p>
          <img src="https://itech.nezrond.fr/wp-content/uploads/2023/07/image-38-1024x631.png"
          alt="" srcset="https://itech.nezrond.fr/wp-content/uploads/2023/07/image-38-1024x631.png 1024w, https://itech.nezrond.fr/wp-content/uploads/2023/07/image-38-300x185.png 300w, https://itech.nezrond.fr/wp-content/uploads/2023/07/image-38-768x473.png 768w, https://itech.nezrond.fr/wp-content/uploads/2023/07/image-38.png 1341w"
          sizes="100vw" width="1024" height="631">
        </p>
        <h2>Conclusion</h2>
        <p>On a maintenant terminé notre installation de notre serveur <strong>zabbix</strong>.
          On verra dans les prochain article comment mettre en place la supervision,
          comment recevoir des alertes.</p>
      </div>
    </div>
  </body>

</html>